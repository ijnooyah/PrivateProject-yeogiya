<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.yj.yeogiya.test">
	<insert id="insert" parameterType="TestVo">
		<selectKey keyProperty="test_no" resultType="int" order="BEFORE">
 			SELECT seq_test_no.NEXTVAL FROM dual
 		</selectKey>
		insert into test 
		values 
			(#{content}, #{test_no})
	</insert>
	<insert id="insertImg" parameterType="list">
		INSERT INTO test_img
		SELECT SEQ_test_img_no.NEXTVAL, A.* FROM (
			
			<foreach collection="list" item="item" separator="UNION ALL">
				SELECT #{item.img_path} FILE_PATH,
							 #{item.test_no} test_no
				FROM DUAL
			</foreach>
			)A
	</insert>
	
	<select id="select" resultType="TestVo">
		select * from test 
		where test_no = #{test_no} 
	</select>
	<select id="selectImg" resultType="TestImg">
		select * from test_img 
		where test_no = #{test_no} 
	</select>

	<update id="updateTest" parameterType="TestVo">
 		UPDATE test
 		SET content = #{content}
 		WHERE test_no = #{test_no}
	</update>
	
	
	<!-- tbl_tag insert -->
	<insert id="insertTag" parameterType="java.util.List">
	    INSERT INTO tbl_tag (tag_no, tag_name)
	    SELECT SEQ_TAG_NO.NEXTVAL, A.* FROM (
	    <foreach item="item" collection="list" separator="UNION ALL" >
	        select #{item.tag_name} TAG_NAME
	        from dual
	         WHERE NOT EXISTS (
			  SELECT TAG_NAME FROM tbl_tag
			  WHERE TAG_NAME = #{item.tag_name}
			)
	    </foreach>) A
	</insert>
	
	<!-- tbl_board_tag insert -->
	<insert id="insertBoardTag"  parameterType="java.util.List">
		INSERT INTO 
			tbl_board_tag (board_no, tag_no)
	    SELECT A.* FROM (
	    <foreach item="item" collection="list" separator="UNION ALL" >
			select #{item.test_no} BOARD_NO,
	        (select tag_no from tbl_tag
			 where tag_name = #{item.tag_name}) TAG_NO
	        from dual
	    </foreach>) A
	</insert>
</mapper>